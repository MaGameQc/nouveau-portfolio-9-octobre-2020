<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>notes taker</title>
</head>
<body id="main">
    <nav class="navbar">
        <ul class="navbar__list">
            <li class="navbar__list___item">
                <a class="navbar__list___item__link" href="">accueil</a>
            </li>
            <li class="navbar__list___item">
                <a class="navbar__list___item__link" href="">accueil</a>
            </li>
            <li class="navbar__list___item">
                <a class="navbar__list___item__link" href="">accueil</a>
            </li>
        </ul>
    </nav>

    <section class="convert">
        <textarea class="convert__textarea"></textarea>
        <button class="convert__button">convertir</button>
        <button class="comma">test comma</button>
    </section>

    <section class="convertedText">
        <div class="convertedText__container">

        </div>
    </section>

    <section class="selectedText">
        <textarea class="selectedText__Textarea"></textarea>
    </section>
</body>
</html>

<script>

    let converter ={
        button : document.querySelector("button"),
        textareaContent : "",
        parent : document.querySelector(".convertedText__container"),
        statements : [],
        selected : [],
        index : 0,
        savedSelectedStatement : "",
        
        initialiseObject : ()=>{
            converter.parent.tabIndex = "0";
            converter.setValues();
            converter.addConvertBtnListener();
        },

        setValues : ()=>{
            converter.parent.innerHTML = "";
            converter.textareaContent = document.querySelector(".convert__textarea").value;
        },

        addConvertBtnListener : ()=>{
                converter.button.addEventListener("click", ()=>{
                converter.setValues();
                converter.getRidOf.all();
                converter.convertText(converter.textareaContent);
                converter.selectStatement();
            });
        },

        addStatementsListener : ()=>{
            // ajouter methode on click
            // console.log(converter.statements.length + " shit");
            converter.statements.forEach((el, index)=>{
                el.addEventListener("click", ()=>{
                    let text = el.textContent;
                    converter.selected.push(text + "\n" + "\n");
                    let selected = document.querySelector(".selectedText__Textarea");
                    selected.value = "";
                    converter.selected.forEach((el)=>{
                        selected.value += el;
                    });
                });

                el.addEventListener("mouseenter", ()=>{
                    let lastSelectedStatement = converter.parent.children[converter.index];
                    converter.colorHandler.saveSelectedStatement(lastSelectedStatement);
                    let changeIndex = converter.index = index;
                    converter.colorHandler.changeStatementColorHover(el);
                    console.log(converter.savedSelectedStatement);
                });
            });
        },

        convertText : (text)=>{
            text.forEach((el)=>{
               converter.appendToConvertedTextarea(el);
            });
            converter.addStatementsListener();
        },

        getRidOf:{

            comma : ()=>{
                converter.textareaContent = converter.textareaContent.split(/[,]/g);
            },

            dot : ()=>{
                converter.textareaContent = converter.textareaContent.split(/[.]/g);
            },

            quote : ()=>{
                converter.textareaContent = converter.textareaContent.split(/["]/g);
            },

            lineBreak : ()=>{
                converter.textareaContent = converter.textareaContent.split(/[\n]/g);
            },

            all : ()=>{
                converter.textareaContent = converter.textareaContent.split(/[\n\.\,\"]/g);
            }
        },

        appendToConvertedTextarea : (text)=>{
             let child = document.createElement("p");
                let textContent = document.createTextNode("- " + text);
                child.classList.add("convertedText__container_phrase");

                converter.statements.push(child);
                child.appendChild(textContent);
                converter.parent.appendChild(child);
        },



        colorHandler : {
            maxIndex : "",

            saveSelectedStatement : (element)=>{
                converter.savedSelectedStatement = element;
            },

            changeStatementColorHover : (element)=>{
                converter.savedSelectedStatement.style.backgroundColor = "white";
                element.style.backgroundColor = "grey";
            },

            changeStatementColorKeydown : (downOrUp)=>{
                if(downOrUp == "down"){
                    converter.colorHandler.saveSelectedStatement(converter.statements[converter.index]);
                    converter.savedSelectedStatement.style.backgroundColor = "white";
                    converter.index --
                    converter.colorHandler.checkIndexSmaller();
                }else{
                    converter.colorHandler.saveSelectedStatement(converter.statements[converter.index]);
                    converter.savedSelectedStatement.style.backgroundColor = "white";
                    converter.index ++
                    converter.colorHandler.checkIndexBigger();                    
                }
            },

            checkIndexBigger : ()=>{
                if(converter.index > converter.colorHandler.maxIndex){
                        converter.index = 0;
                        converter.statements[converter.index].style.backgroundColor = "grey";
                        converter.statements[converter.index].scrollIntoView();
                    }else{
                        converter.statements[converter.index].style.backgroundColor = "grey";
                        converter.statements[converter.index].scrollIntoView();
                    }
            },

            checkIndexSmaller : () =>{
                if(converter.index < 0){
                        converter.index = converter.colorHandler.maxIndex;
                        converter.statements[converter.index].style.backgroundColor = "grey";
                        converter.statements[converter.index].scrollIntoView();
                    }else{
                        converter.statements[converter.index].style.backgroundColor = "grey";
                        converter.statements[converter.index].scrollIntoView();
                    }
            },


        },

        selectStatement : ()=>{

            converter.colorHandler.maxIndex = converter.statements.length-1;
            converter.statements[converter.index].style.backgroundColor = "grey";

            converter.parent.addEventListener("keydown", (e)=>{
                e.preventDefault();
                let key = e.keyCode;
                if(key == 40){ //up
                    converter.colorHandler.changeStatementColorKeydown("up");
                }
                if(key == 38){ //down
                    converter.colorHandler.changeStatementColorKeydown("down");
                }

                if(key == 13){ //enter
                    let text = converter.statements[converter.index].textContent;
                    // converter.addToSelectedStatements(text);
                    converter.selected.push(text + "\n" + "\n");
                    let selected = document.querySelector(".selectedText__Textarea");
                    selected.value = "";
                    converter.selected.forEach((el)=>{
                        selected.value += el;
                    });
                }
            });
        },

    }

    converter.initialiseObject();



</script>


<style>

*{
    box-sizing: border-box;
    margin : 0;
    padding: 0; 
}

html{
    font-size: 16px;
}

#main{
    display: grid;
    grid-template-areas: 
    "navbar navbar"
    "convertBtn convertBtn"
    "convertedText selectedText"
    ;

    grid-template-rows: 6rem 0.2fr auto;
    grid-template-columns: 1fr 1fr;
    min-height: 100vh;
    width: 100vw;
}

.navbar{
    grid-area: navbar;
    background-color: #0469FF;
    display: flex;
    align-items: center;
    justify-content: flex-end;
}

.convert{
    grid-area: convertBtn;
    background-color: cadetblue;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.convert__textarea{
width: 80%;
height: 80%;
}

.convert__button{

}

.convertedText{
    grid-area: convertedText;
    background-color: aqua;
    display: flex;
    justify-content: center;
    align-items: center;
}

.convertedText__container{
    width: 80%;
    height: 40vh;
    background-color: white;
    overflow-y: scroll;
}

.convertedText__container_phrase{
    margin: 1rem auto; 
}

.selectedText{
    grid-area: selectedText;
    background-color: aquamarine;
    display: flex;
    justify-content: center;
    align-items: center;

}

.selectedText__Textarea{
    width: 80%;
    height: 80%;
}


</style>